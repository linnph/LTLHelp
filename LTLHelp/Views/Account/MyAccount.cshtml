@model LTLHelp.Models.User
@{
    ViewData["Title"] = "Tài Khoản Của Tôi";
    var totalDonated = ViewBag.TotalDonated as decimal? ?? 0;
    var totalDonations = ViewBag.TotalDonations as int? ?? 0;
    var confirmedAmount = ViewBag.ConfirmedAmount as decimal? ?? 0;
    var donations = Model?.Donations?.OrderByDescending(d => d.CreatedAt).ToList() ?? new List<Donation>();
}

<!--==============================
    Breadcumb
============================== -->
<div class="breadcumb-wrapper " data-bg-src="/assets/img/bg/breadcumb-bg.jpg" data-overlay="theme">
    <div class="container">
        <div class="breadcumb-content">
            <h1 class="breadcumb-title">Tài Khoản Của Tôi</h1>
            <ul class="breadcumb-menu">
                <li><a href="@Url.Action("Index", "Home")">Trang Chủ</a></li>
                <li>Tài Khoản Của Tôi</li>
            </ul>
        </div>
    </div>
</div>

<!--==============================
My Account Area   
==============================-->
<div class="space overflow-hidden position-relative z-index-common">
    <div class="container">
        <div class="account-tabs">
            <ul class="nav nav-tabs" id="accountTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="donations-tab" data-bs-toggle="tab" data-bs-target="#donations" type="button" role="tab" aria-controls="donations" aria-selected="true">
                        <i class="fas fa-heart me-2"></i> Lịch Sử Quyên Góp
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">
                        <i class="fas fa-user me-2"></i> Thông Tin Cá Nhân
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="accountTabsContent">
                <!-- Donation History Tab -->
                <div class="tab-pane fade show active" id="donations" role="tabpanel" aria-labelledby="donations-tab">
                    <!-- Donation Summary -->
                    <div class="donation-summary">
                        <div class="row g-4">
                            <div class="col-md-4">
                                <div class="donation-summary-item">
                                    <h3>@totalDonated.ToString("N0") VNĐ</h3>
                                    <p>Tổng Đã Quyên Góp</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="donation-summary-item">
                                    <h3>@totalDonations</h3>
                                    <p>Tổng Số Lần Quyên Góp</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="donation-summary-item">
                                    <h3>@confirmedAmount.ToString("N0") VNĐ</h3>
                                    <p>Số Tiền Đã Xác Nhận</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Donation Table -->
                    <div class="donation-table">
                        <h3 class="mb-4">Lịch Sử Quyên Góp</h3>
                        @if (donations.Any())
                        {
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Ngày</th>
                                            <th>Chiến Dịch</th>
                                            <th>Số Tiền</th>
                                            <th>Trạng Thái</th>
                                            <th>Hành Động</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var donation in donations)
                                        {
                                            var statusClass = (donation.Status == "Thành công" || donation.Status == "Đã thanh toán") 
                                                ? "status-confirmed" 
                                                : "status-pending";
                                            
                                            <tr>
                                                <td>@(donation.CreatedAt?.ToString("dd/MM/yyyy") ?? "N/A")</td>
                                                <td>
                                                    @if (donation.Campaign != null)
                                                    {
                                                        <a href="@Url.Action("Details", "Campaign", new { id = donation.Campaign.CampaignId })" class="text-theme">
                                                            @donation.Campaign.Title
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-muted">Chiến dịch không xác định</span>
                                                    }
                                                </td>
                                                <td><strong>@donation.Amount.ToString("N0") VNĐ</strong></td>
                                                <td>
                                                    <span class="status-badge @statusClass">
                                                        @(donation.Status ?? "Chờ xác nhận")
                                                    </span>
                                                </td>
                                                <td>
                                                    <a href="@Url.Action("Details", "Campaign", new { id = donation.CampaignId })" class="text-theme">
                                                        <i class="fas fa-eye me-1"></i> Xem
                                                    </a>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-5">
                                <i class="fas fa-inbox" style="font-size: 64px; color: var(--smoke-color); margin-bottom: 20px;"></i>
                                <p class="text-muted">Bạn chưa có lịch sử quyên góp nào. Hãy bắt đầu quyên góp ngay hôm nay!</p>
                                <a href="@Url.Action("Index", "Campaign")" class="th-btn style3 mt-3">
                                    <i class="fas fa-heart me-2"></i> Xem Chiến Dịch
                                </a>
                            </div>
                        }
                    </div>
                </div>

                <!-- Profile Settings Tab -->
                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="row">
                        <div class="col-lg-8 mx-auto">
                            <div class="contact-form-v1">
                                <div class="text-center mb-40">
                                    <h2 class="sec-title">Thông Tin Cá Nhân</h2>
                                    <p class="sec-text">Cập nhật thông tin cá nhân của bạn</p>
                                </div>
                                
                                <!-- Profile Avatar -->
                                <div class="profile-avatar">
                                    <img src="@(Model?.UserProfile?.AvatarUrl ?? "/assets/img/team/team_1_1.png")" alt="Profile">
                                    <div>
                                        <button type="button" class="th-btn btn-sm btn-upload">
                                            <i class="fas fa-camera me-2"></i> Đổi Ảnh
                                        </button>
                                    </div>
                                </div>

                                <!-- Profile Info Display -->
                                <div class="profile-info mb-4">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label"><strong>Username:</strong></label>
                                            <p>@Model?.UserName</p>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label"><strong>Email:</strong></label>
                                            <p>@Model?.Email</p>
                                        </div>
                                        @if (Model?.UserProfile != null)
                                        {
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label"><strong>Họ:</strong></label>
                                                <p>@(Model.UserProfile.FirstName ?? "Chưa cập nhật")</p>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label"><strong>Tên:</strong></label>
                                                <p>@(Model.UserProfile.LastName ?? "Chưa cập nhật")</p>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label"><strong>Số Điện Thoại:</strong></label>
                                                <p>@(Model.UserProfile.Phone ?? "Chưa cập nhật")</p>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label"><strong>Địa Chỉ:</strong></label>
                                                <p>@(Model.UserProfile.AddressLine ?? "Chưa cập nhật")</p>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label"><strong>Thành Phố:</strong></label>
                                                <p>@(Model.UserProfile.City ?? "Chưa cập nhật")</p>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label"><strong>Quốc Gia:</strong></label>
                                                <p>@(Model.UserProfile.Country ?? "Chưa cập nhật")</p>
                                            </div>
                                        }
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label"><strong>Ngày Tạo:</strong></label>
                                            <p>@(Model?.CreatedAt?.ToString("dd/MM/yyyy") ?? "N/A")</p>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label"><strong>Lần Đăng Nhập Cuối:</strong></label>
                                            <p>@(Model?.LastLoginAt?.ToString("dd/MM/yyyy HH:mm") ?? "Chưa đăng nhập")</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center">
                                    <a href="@Url.Action("Index", "Campaign")" class="th-btn style3 me-2">
                                        <i class="fas fa-heart me-2"></i> Xem Chiến Dịch
                                    </a>
                                    <a href="@Url.Action("History", "Donation")" class="th-btn style2 me-2">
                                        <i class="fas fa-history me-2"></i> Lịch Sử Quyên Góp
                                    </a>
                                    <a href="@Url.Action("Logout", "Account")" class="th-btn style2">
                                        <i class="fas fa-sign-out-alt me-2"></i> Đăng Xuất
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .account-tabs .nav-tabs {
        border-bottom: 2px solid var(--th-border-color);
        margin-bottom: 40px;
    }
    .account-tabs .nav-tabs .nav-link {
        border: none;
        border-bottom: 3px solid transparent;
        color: var(--body-color);
        padding: 15px 30px;
        font-weight: 600;
        background: transparent;
        margin-bottom: -2px;
    }
    .account-tabs .nav-tabs .nav-link:hover {
        border-color: transparent;
        color: var(--theme-color);
    }
    .account-tabs .nav-tabs .nav-link.active {
        color: var(--theme-color);
        border-bottom-color: var(--theme-color);
        background: transparent;
    }
    .donation-summary {
        background: var(--smoke-color);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 40px;
    }
    .donation-summary-item {
        text-align: center;
    }
    .donation-summary-item h3 {
        font-size: 32px;
        color: var(--theme-color);
        margin-bottom: 10px;
        font-weight: 700;
    }
    .donation-summary-item p {
        margin: 0;
        color: var(--body-color);
        font-weight: 600;
    }
    .status-badge {
        display: inline-block;
        padding: 6px 16px;
        border-radius: 50px;
        font-size: 14px;
        font-weight: 600;
    }
    .status-pending {
        background: #FFF3CD;
        color: #856404;
    }
    .status-confirmed {
        background: #D4EDDA;
        color: #155724;
    }
    .donation-table {
        background: var(--white-color);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.08);
    }
    .donation-table h3 {
        color: var(--title-color);
        font-weight: 700;
        margin-bottom: 25px;
    }
    .donation-table table {
        width: 100%;
        border-collapse: collapse;
    }
    .donation-table thead {
        background: var(--smoke-color);
    }
    .donation-table th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
        color: var(--title-color);
        border-bottom: 2px solid var(--th-border-color);
    }
    .donation-table td {
        padding: 15px;
        border-bottom: 1px solid var(--th-border-color);
        vertical-align: middle;
    }
    .donation-table tbody tr:hover {
        background: var(--smoke-color);
    }
    .donation-table .text-theme {
        color: var(--theme-color);
        text-decoration: none;
        font-weight: 600;
        transition: color 0.3s;
    }
    .donation-table .text-theme:hover {
        color: var(--theme-dark);
        text-decoration: underline;
    }
    .profile-avatar {
        text-align: center;
        margin-bottom: 30px;
    }
    .profile-avatar img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--theme-color);
    }
    .profile-avatar .btn-upload {
        margin-top: 15px;
    }
    .profile-info {
        background: var(--smoke-color);
        border-radius: 15px;
        padding: 30px;
    }
    .profile-info label {
        color: var(--title-color);
        font-weight: 600;
    }
    .profile-info p {
        color: var(--body-color);
        margin: 0;
    }
</style>

