@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    .stat-card {
        border-radius: 16px;
        padding: 22px;
        color: white;
        font-weight: 600;
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        transition: .3s;
    }

        .stat-card:hover {
            transform: scale(1.05);
        }

    .section-box {
        background: white;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 5px 18px rgba(0,0,0,0.08);
    }
</style>

<h2 class="mb-4 font-weight-bold">📊 Dashboard Tổng Quan</h2>

<div class="row">

    <div class="col-md-3 mb-4">
        <div class="stat-card" style="background:#3498db;">
            <h6>Tổng chiến dịch</h6>
            <h2>@ViewBag.TotalCampaigns</h2>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="stat-card" style="background:#2ecc71;">
            <h6>Người dùng</h6>
            <h2>@ViewBag.TotalUsers</h2>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="stat-card" style="background:#f1c40f;">
            <h6>Khoản quyên góp</h6>
            <h2>@ViewBag.TotalDonations</h2>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="stat-card" style="background:#e74c3c;">
            <h6>Tổng tiền</h6>
            <h2>@String.Format("{0:N0}", ViewBag.TotalMoney) VNĐ</h2>
        </div>
    </div>

</div>


<!-- BIỂU ĐỒ -->
<div class="row">

    <div class="col-md-8 mb-4">
        <div class="section-box">
            <h5>📈 Quyên góp theo tháng</h5>
            <canvas id="donationChart"></canvas>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="section-box">
            <h5>📌 Tỷ lệ chiến dịch</h5>
            <canvas id="campaignPie"></canvas>
        </div>
    </div>

</div>

<!-- Chiến dịch sắp hết hạn -->
<div class="section-box mt-4">
    <h4>⏳ Chiến dịch sắp hết hạn</h4>
    <ul>
        @foreach (var c in ViewBag.ExpiringCampaigns)
        {
            <li>@c.Title — kết thúc: @c.EndDate</li>
        }
    </ul>
</div>

<!-- TOP CHIẾN DỊCH -->
<div class="row mt-4">

    <div class="col-md-6">
        <div class="section-box">
            <h4>🔥 Top chiến dịch mạnh nhất</h4>
            <ul>
                @foreach (var c in ViewBag.TopCampaigns)
                {
                    <li>@c.Title — @String.Format("{0:N0}", c.RaisedAmount) VNĐ</li>
                }
            </ul>
        </div>
    </div>

    <div class="col-md-6">
        <div class="section-box">
            <h4>⚠ Chiến dịch yếu nhất</h4>
            <ul>
                @foreach (var c in ViewBag.WeakCampaigns)
                {
                    <li>@c.Title — @String.Format("{0:N0}", c.RaisedAmount) VNĐ</li>
                }
            </ul>
        </div>
    </div>

</div>

<!-- TOP DONOR -->
<div class="section-box mt-4">
    <h4>⭐ Người dùng quyên góp nhiều nhất</h4>
    <ul>
        @foreach (var d in ViewBag.TopDonors)
        {
            <li>@d.User — @String.Format("{0:N0}", d.Total) VNĐ</li>
        }
    </ul>
</div>

<!-- SCRIPT BIỂU ĐỒ -->
<script>
    var ctx = document.getElementById("donationChart");
    var donationChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
                                                   ((IEnumerable<dynamic>)ViewBag.DonationMonths).Select(x => "Tháng " + x.Month))),
            datasets: [{
                label: "Số tiền quyên góp",
                data: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
                                                 ((IEnumerable<dynamic>)ViewBag.DonationMonths).Select(x => x.Total))),
                backgroundColor: "rgba(52, 152, 219, 0.3)",
                borderColor: "#3498db",
                borderWidth: 3,
                tension: 0.4,
                fill: true
            }]
        }
    });

    var pie = new Chart(document.getElementById("campaignPie"), {
        type: "doughnut",
        data: {
            labels: ["Đang hoạt động", "Đã kết thúc"],
            datasets: [{
                data: [@ViewBag.ActiveCampaigns, @ViewBag.EndedCampaigns],
                backgroundColor: ["#2ecc71", "#e74c3c"]
            }]
        }
    });
</script>
